<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- 
        Views do Tanque de Combustível e Entradas
        Design inspirado nas referências HTML fornecidas
    -->
    
    <!-- ===== TANQUE DE COMBUSTÍVEL ===== -->
    
    <!-- Form View: Tanque -->
    <record id="view_tanque_form" model="ir.ui.view">
        <field name="name">controle.combustivel.tanque.form</field>
        <field name="model">controle.combustivel.tanque</field>
        <field name="arch" type="xml">
            <form string="Tanque de Combustível">
                <header>
                    <button name="action_recalculate_stock" 
                            string="Recalcular Saldo" 
                            type="object" 
                            class="btn-primary"
                            groups="controle_combustivel.group_analista"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nome do Tanque"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="Informações do Tanque">
                            <field name="capacidade" widget="float"/>
                            <field name="estoque_manual" 
                                   groups="controle_combustivel.group_administrador"/>
                        </group>
                        <group string="Status Atual">
                            <field name="estoque_atual" widget="float"/>
                            <field name="percentual_nivel" widget="progressbar"/>
                            <field name="status_nivel" widget="badge" 
                                   decoration-success="status_nivel == 'normal'"
                                   decoration-warning="status_nivel == 'atencao'"
                                   decoration-danger="status_nivel == 'critico'"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Movimentações">
                            <field name="total_entradas"/>
                            <field name="total_saidas"/>
                        </group>
                        <group string="Últimas Atualizações">
                            <field name="ultima_entrada"/>
                            <field name="ultima_saida"/>
                        </group>
                    </group>
                    
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Tree View: Tanque -->
    <record id="view_tanque_tree" model="ir.ui.view">
        <field name="name">controle.combustivel.tanque.tree</field>
        <field name="model">controle.combustivel.tanque</field>
        <field name="arch" type="xml">
            <list string="Tanques de Combustível">
                <field name="name"/>
                <field name="capacidade"/>
                <field name="estoque_atual"/>
                <field name="percentual_nivel" widget="progressbar"/>
                <field name="status_nivel" widget="badge"
                       decoration-success="status_nivel == 'normal'"
                       decoration-warning="status_nivel == 'atencao'"
                       decoration-danger="status_nivel == 'critico'"/>
            </list>
        </field>
    </record>
    
    <!-- Action: Tanque Form (status) -->
    <record id="action_tanque_form" model="ir.actions.act_window">
        <field name="name">Status do Tanque</field>
        <field name="res_model">controle.combustivel.tanque</field>
        <field name="view_mode">form</field>
        <field name="res_id" ref="tanque_principal"/>
        <field name="target">current</field>
    </record>
    
    <!-- Action: Tanque Tree (configuração) -->
    <record id="action_tanque_tree" model="ir.actions.act_window">
        <field name="name">Configurar Tanques</field>
        <field name="res_model">controle.combustivel.tanque</field>
        <field name="view_mode">list,form</field>
    </record>
    
    <!-- ===== ENTRADAS DE COMBUSTÍVEL ===== -->
    
    <!-- Form View: Entrada -->
    <record id="view_entrada_form" model="ir.ui.view">
        <field name="name">controle.combustivel.entrada.form</field>
        <field name="model">controle.combustivel.entrada</field>
        <field name="arch" type="xml">
            <form string="Entrada de Combustível">
                <header>
                    <button name="action_confirmar" 
                            string="Confirmar" 
                            type="object" 
                            class="btn-primary"
                            invisible="state != 'rascunho'"/>
                    <button name="action_cancelar" 
                            string="Cancelar" 
                            type="object"
                            invisible="state != 'rascunho'"/>
                    <button name="action_voltar_rascunho" 
                            string="Voltar a Rascunho" 
                            type="object"
                            invisible="state != 'cancelado'"/>
                    <field name="state" widget="statusbar" 
                           statusbar_visible="rascunho,confirmado"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="Informações da Entrada">
                            <field name="tanque_id" readonly="state != 'rascunho'"/>
                            <field name="data_hora" readonly="state != 'rascunho'"/>
                            <field name="usuario_id"/>
                        </group>
                        <group string="Valores">
                            <field name="quantidade_litros" readonly="state != 'rascunho'"/>
                            <field name="valor_por_litro" readonly="state != 'rascunho'"/>
                            <field name="total"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Fornecedor">
                            <field name="fornecedor" readonly="state != 'rascunho'"/>
                            <field name="nota_fiscal" readonly="state != 'rascunho'"/>
                        </group>
                    </group>
                    
                    <group string="Observações">
                        <field name="observacao" nolabel="1" 
                               readonly="state != 'rascunho'"
                               placeholder="Observações sobre a entrada..."/>
                    </group>
                </sheet>
                <chatter>
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </chatter>
            </form>
        </field>
    </record>
    
    <!-- Tree View: Entrada -->
    <record id="view_entrada_tree" model="ir.ui.view">
        <field name="name">controle.combustivel.entrada.tree</field>
        <field name="model">controle.combustivel.entrada</field>
        <field name="arch" type="xml">
            <list string="Entradas de Combustível" 
                  decoration-muted="state == 'cancelado'"
                  decoration-success="state == 'confirmado'">
                <field name="name"/>
                <field name="data_hora"/>
                <field name="tanque_id"/>
                <field name="quantidade_litros" sum="Total Litros"/>
                <field name="valor_por_litro"/>
                <field name="total" sum="Total R$"/>
                <field name="fornecedor"/>
                <field name="state" widget="badge"
                       decoration-info="state == 'rascunho'"
                       decoration-success="state == 'confirmado'"
                       decoration-muted="state == 'cancelado'"/>
            </list>
        </field>
    </record>

    <!-- Search View: Entrada -->
    <record id="view_entrada_search" model="ir.ui.view">
        <field name="name">controle.combustivel.entrada.search</field>
        <field name="model">controle.combustivel.entrada</field>
        <field name="arch" type="xml">
            <search string="Buscar Entradas">
                <field name="name"/>
                <field name="fornecedor"/>
                <field name="nota_fiscal"/>
                <separator/>
                <filter name="filter_rascunho" string="Rascunho" domain="[('state', '=', 'rascunho')]"/>
                <filter name="filter_confirmado" string="Confirmado" domain="[('state', '=', 'confirmado')]"/>
                <group name="group_by">
                    <filter name="group_tanque" string="Tanque" context="{'group_by': 'tanque_id'}"/>
                </group>
            </search>
        </field>
    </record>
    

    
    <!-- Action: Entradas -->
    <record id="action_entrada_tree" model="ir.actions.act_window">
        <field name="name">Entradas de Combustível</field>
        <field name="res_model">controle.combustivel.entrada</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_entrada_search"/>
        <field name="context">{'search_default_filter_confirmado': 0}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Registre a primeira entrada de combustível
            </p>
            <p>
                As entradas de combustível aumentam o estoque do tanque.
                Use para registrar compras ou reposições.
            </p>
        </field>
    </record>

</odoo>
